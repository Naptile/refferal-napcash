<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NapCash â€“ Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<style>
body { background:#000; color:#fff; margin:0; font-family: Arial, sans-serif; }
.nav { display:flex; align-items:center; justify-content:space-between; padding:15px 20px; background:#111; position:relative; }
.brand { font-size:1.5rem; color:orange; font-weight:bold; }
.nav-links { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.btn-orange { background:orange; border:none; color:black; font-weight:bold; padding:8px 12px; border-radius:6px; cursor:pointer; transition:0.3s; }
.btn-orange:disabled { background:gray; color:#ddd; cursor:not-allowed; }
.btn-orange:hover:enabled { background:#ff9900; color:#fff; }
.hero { max-width:1000px; margin:20px auto; padding:20px; }
.card { background:#111; padding:25px; border-radius:12px; }
.dashboard-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-top:20px; }
.info-card { background:#222; padding:20px; border-radius:10px; text-align:center; }
.info-card h3 { color:orange; margin-bottom:8px; }
input#refLink { width:100%; padding:5px; border:none; border-radius:5px; color:#000; margin-bottom:8px; }
.referral-list, .withdrawal-list { list-style:none; padding-left:0; margin-top:10px; }
.referral-list li, .withdrawal-list li { display:flex; justify-content:space-between; align-items:center; background:#222; padding:10px; border-radius:6px; margin-bottom:8px; }
.status-badge { font-size:0.8rem; padding:4px 8px; border-radius:4px; font-weight:bold; color:#fff; }
.active { background:green; }
.inactive { background:orange; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:#111; padding:20px; border-radius:10px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:10px; }
.modal-content input { padding:8px; border-radius:5px; border:none; width:100%; }
.close-modal { align-self:flex-end; cursor:pointer; font-size:1.2rem; color:orange; }
@media (max-width:768px){
  .dashboard-grid { grid-template-columns:1fr; gap:15px; }
  .info-card { font-size:0.95rem; padding:15px; }
  .referral-list li, .withdrawal-list li { font-size:0.9rem; padding:10px; }
  input#refLink { font-size:0.9rem; }
  .nav { flex-direction:column; align-items:flex-start; }
  .nav-links { flex-direction:column; width:100%; gap:10px; margin-top:10px; }
}
</style>
</head>
<body>

<div class="nav">
  <div class="brand">NapCash</div>
  <div class="nav-links">
    <span id="userName" style="color:orange; font-weight:bold;"></span>
    <button id="profileBtn" class="btn-orange">Profile</button>
    <button id="logoutBtn" class="btn-orange">Logout</button>
  </div>
</div>

<div class="hero">
  <div class="card">
    <h2>Dashboard</h2>
    <div class="dashboard-grid">
      <!-- Dashboard cards here -->
    </div>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal" id="profileModal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">&times;</span>
    <h3>Update Profile</h3>
    <input type="text" id="modalName" placeholder="Full Name">
    <input type="email" id="modalEmail" placeholder="Email">
    <input type="tel" id="modalPhone" placeholder="Phone">
    <button id="saveProfileBtn" class="btn-orange">Save</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDybgITS1zttYLSa1_vsV0vYLzqbr42abA",
  authDomain: "napcash-3e696.firebaseapp.com",
  projectId: "napcash-3e696",
  storageBucket: "napcash-3e696.firebasestorage.app",
  messagingSenderId: "720221815295",
  appId: "1:720221815295:web:e8b299b30909c6cc9927ca"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const profileBtn = document.getElementById("profileBtn");
const logoutBtn = document.getElementById("logoutBtn");
const profileModal = document.getElementById("profileModal");
const closeModal = document.getElementById("closeModal");
const saveProfileBtn = document.getElementById("saveProfileBtn");
const modalName = document.getElementById("modalName");
const modalEmail = document.getElementById("modalEmail");
const modalPhone = document.getElementById("modalPhone");
const userName = document.getElementById("userName");

// Auth state
auth.onAuthStateChanged(async user=>{
  if(!user) return window.location.href="/login.html";
  const uid = user.uid;
  const doc = await db.collection("users").doc(uid).get();
  if(!doc.exists) return;
  const data = doc.data();
  
  userName.textContent = data.fullName || data.email;

  // Profile modal
  profileBtn.onclick = ()=>{
    modalName.value = data.fullName || "";
    modalEmail.value = data.email || "";
    modalPhone.value = data.phone || "";
    profileModal.style.display = "flex";
  };

  closeModal.onclick = ()=>profileModal.style.display="none";
  window.onclick = e=>{ if(e.target===profileModal) profileModal.style.display="none"; };

  saveProfileBtn.onclick = async ()=>{
    await db.collection("users").doc(uid).update({
      fullName: modalName.value,
      email: modalEmail.value,
      phone: modalPhone.value,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    alert("Profile updated!");
    profileModal.style.display="none";
    userName.textContent = modalName.value;
  };

  logoutBtn.onclick = async ()=>{
    await auth.signOut();
    window.location.href="/login.html";
  };
});
</script>
</body>
</html>
